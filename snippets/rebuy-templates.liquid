<script id="rebuy-recommended-template" type="text/template">
    <div
      class="rebuy-widget"
      v-cloak
      v-on:click="stopPropagation($event)"
      v-bind:id="'rebuy-widget-' + id"
      v-bind:class="['widget-type-' + config.type.replace('_','-'), 'widget-display-' + config.display_type, products.length > 0 ? 'is-visible' : 'is-hidden', 'widget-layout-' + currentLayout()]"
    >
      <div
        class="rebuy-widget-container"
        v-cloak
        v-bind:class="['widget-display-' + config.display_type, visible ? 'is-visible' : 'is-hidden' ]"
        v-on:click.self="hide()"
      >
        <div class="rebuy-widget-content">
          <div class="rebuy-modal-close" v-on:click="hide()" aria-label="close modal">
            <i class="fas fa-times" aria-hidden="true"></i>
          </div>

          <div class="rebuy-timer" v-if="hasTimer()">
            <p class="rebuy-timer-title" v-if="config.language.timer_title">
              <span v-html="config.language.timer_title"></span>
              <span class="rebuy-timer-minutes" v-html="config.timer.duration_minutes"></span>:<span
                class="rebuy-timer-seconds"
                v-html="config.timer.duration_seconds"
              ></span>
            </p>
          </div>

          <h3 class="super-title" v-if="config.language.super_title != ''" v-html="config.language.super_title"></h3>

          <h4 class="primary-title" v-if="config.language.title != ''" v-html="config.language.title"></h4>

          <div class="description" v-if="config.language.description != ''" v-html="config.language.description"></div>

          <div class="rebuy-product-grid" v-bind:class="layoutClasses" tabindex="0" role="list">
            <div
              v-for="(product, product_index) in products"
              v-bind:class="
                [
                    product.handle,
                    'product-id-' + product.id,
                    cartHasProduct(product) ? 'cart-has-item' : '',
                    productTagClasses(product),
                    hasSplideCarousel ? 'splide__slide' : '',
                ]
              "
              aria-label="product"
              class="rebuy-product-block"
              role="listitem"
            >

              <div class="product-tag" v-if="product.tags.includes('New')">
                  <span class="svg-wrapper"><img src="https://cdn.shopify.com/s/files/1/0707/7756/9461/files/new-tag.svg" width="12" height="15" alt="New Tag"/></span>
                  <span>New</span>
              </div>

              <div class="rebuy-product-media">
                <a
                  class="rebuy-product-image"
                  tabindex="-1"
                  v-bind:href="learnMoreURL(product)"
                  v-bind:style="imageStyles"
                  v-bind:class="[hasLearnMore() ? 'clickable' : '']"
                  target="_self"
                  rel="nofollow"
                >
                  <div class="rebuy-image-wrapper">
                    <img
                      class="primary-image"
                      v-bind:loading="product_index > 1 ? 'lazy' : 'eager'"
                      v-bind:src="itemImage(product, product.selected_variant, '400x400')"
                      v-bind:alt="itemImageAlt(product, product.selected_variant)"
                    >
                    <img
                      class="fourth-image"
                      v-if="product.images.length > 1"
                      v-bind:src="product.images[3].src + '&width=400'"
                      v-bind:alt="product.title + ' fourth image'"
                    >
                  </div>
                </a>
              </div>

              <div class="rebuy-product-info">
                <a
                  role="heading"
                  aria-level="5"
                  class="rebuy-product-title"
                  v-bind:href="learnMoreURL(product)"
                  v-html="product.title"
                  v-bind:class="[hasLearnMore() ? 'clickable' : '']"
                  v-bind:aria-label="'View ' + product.title"
                  target="_self"
                  rel="nofollow"
                ></a>

                <div
                  class="rebuy-variant-title"
                  v-if="showVariantTitle(product)"
                  v-html="product.selected_variant.title"
                ></div>

                <div class="rebuy-product-review" v-if="hasProductReviews(product)" aria-label="product star rating">
                  <span class="rebuy-star-rating">
                    <span
                      v-if="product.reviews.star_rating"
                      class="rebuy-star-rating-value sr-only"
                      v-html="product.reviews.star_rating + ' stars out of 5 stars'"
                    >
                    </span>
                    <span class="rebuy-star-rating-background"></span>
                    <span
                      class="rebuy-star-rating-foreground"
                      v-bind:style="{ width: productReviewRatingPercentage(product) }"
                    ></span>
                  </span>
                  <span class="rebuy-review-count" v-html="productReviewCount(product)"></span>
                </div>

                <div class="rebuy-product-price">
                  <div v-if="variantOnSale(product, product.selected_variant)">
                    <span class="rebuy-money sale">
                      <span class="sr-only">Sale price</span>
                      <span tabindex="0" v-html="formatMoney(variantPrice(product, product.selected_variant))"></span>
                    </span>
                    <span class="rebuy-money compare-at">
                      <span class="sr-only">Original price</span>
                      <span v-html="formatMoney(variantCompareAtPrice(product, product.selected_variant))"></span>
                    </span>
                  </div>
                  <div v-if="!(variantOnSale(product, product.selected_variant))">
                    <span class="rebuy-money">
                      <span class="sr-only">Price</span>
                      <span tabindex="0" v-html="formatMoney(variantPrice(product, product.selected_variant))"></span>
                    </span>
                  </div>
                </div>

                <div
                  class="rebuy-product-description"
                  v-if="showProductDescription(product)"
                  v-html="text(product.body_html)"
                ></div>
              </div>

              <!-- variant selector etc stays the same -->
              <div class="rebuy-product-options" v-if="showVariantSelect(product)">
                <!-- ... your variant select/swatches code here ... -->
              </div>

              <div
                class="rebuy-product-custom-actions"
                v-if="productTagClasses(product) && product.tags.includes('easy-bundle')"
              >
                <a v-bind:href="learnMoreURL(product)" class="quick-add__submit button button--full-width button--secondary">
                  Customize Your Bundle
                </a>
              </div>

              <div class="rebuy-product-actions" v-else>
                <!-- subscription + quantity + add to cart button stays the same -->
                <button
                  class="rebuy-button"
                  v-bind:class="{ working: (product.status != 'ready' && product.status != 'selecting') }"
                  v-bind:disabled="!(variantAvailable(product.selected_variant)) || (product.status != 'ready' && product.status != 'selecting')"
                  v-bind:aria-label="buttonAriaLabel(product)"
                  v-on:click="addToCart(product)"
                  type="button"
                >
                  <span v-html="buttonLabel(product)"></span>
                </button>
              </div>
            </div>
          </div>

          <div class="rebuy-modal-actions" v-if="showContinueButton()">
            <button
              class="rebuy-button decline"
              v-on:click="hide()"
              type="button"
            >
              <span v-html="continueLabel()"></span>
            </button>
          </div>

          <div class="powered-by-rebuy">
            <a v-bind:href="'https://rebuyengine.com/?shop=' + config.shop.myshopify_domain" target="_blank" rel="noopener">
              Powered by Rebuy
            </a>
          </div>
        </div>
      </div>
    </div>
</script>
